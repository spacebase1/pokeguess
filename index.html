<!doctype html>
<html lang="en-US">
<head>
	<meta charset="UTF-8" />
	<meta name="viewport" content="width=device-width" />
	<link rel="icon" href="./data/icon.ico" type="image/ico">
	<link rel="stylesheet" href="./css/index.css">
	<title>Pokeguess</title>
</head>
<body>
	<div id="settings-div">
		<span>Options:</span>
		<div><input type="checkbox" id="setting1" onclick="refreshName();"><span onclick="spanToggle(1, false)">Show Number</span></div>
		<div><input type="checkbox" id="setting2" onclick="refreshName();"><span onclick="spanToggle(2, false)">Always Show Name</span></div>
		<div><input type="checkbox" id="setting3" onclick="refreshName();"><span onclick="spanToggle(3, false)">Always Show Region</span></div>
		<button onclick="toggleSilhouette()">Toggle Silhouette</button>
	</div>
	<div id="poke-div">
		<img id="poke-img" src="data/questionMark.png" onmouseenter="showName()" onmouseleave="hideName()">
		<span id="poke-name"></span>
		<span id="poke-region"></span>
		<button onclick="random()">Random</button>
	</div>
	<div id="checkbox-div">
		<div><input type="checkbox" id="gen1-check" checked><span onclick="spanToggle(0, true)">Gen 1</span></div>
		<div><input type="checkbox" id="gen2-check" checked><span onclick="spanToggle(1, true)">Gen 2</span></div>
		<div><input type="checkbox" id="gen3-check" checked><span onclick="spanToggle(2, true)">Gen 3</span></div>
		<div><input type="checkbox" id="gen4-check" checked><span onclick="spanToggle(3, true)">Gen 4</span></div>
		<div><input type="checkbox" id="gen5-check" checked><span onclick="spanToggle(4, true)">Gen 5</span></div>
		<div><input type="checkbox" id="gen6-check" checked><span onclick="spanToggle(5, true)">Gen 6</span></div>
		<div><input type="checkbox" id="gen7-check" checked><span onclick="spanToggle(6, true)">Gen 7</span></div>
		<div><input type="checkbox" id="gen8-check" checked><span onclick="spanToggle(7, true)">Gen 8</span></div>
		<div><input type="checkbox" id="gen9-check" checked><span onclick="spanToggle(8, true)">Gen 9</span></div>
		<button onclick="toggleCheckboxes()">Toggle All</button>
	</div>
<script type="text/javascript">
	let gens;
	fetch('./data.json')
	    .then((response) => response.json())
	    .then((json) => gens = json)
		.then( _ => {for(let i = 0; i < gens.length; i++){gens[i]['checkbox'] = document.getElementById('gen' + (i + 1) + '-check');}});
	let current;
	let show_number = document.getElementById("setting1");
	let always_show = document.getElementById("setting2");
	let always_region = document.getElementById("setting3");
	const poke_img = document.getElementById("poke-img");
	const poke_name = document.getElementById("poke-name");
	const poke_region = document.getElementById("poke-region");

	function randItem(array){return array.length ? array[Math.floor(Math.random() * array.length)] : 'empty';}
	function getCheckedGens(){
		let valid_gens = [];
		for(const item of gens){if(item['checkbox'].checked){valid_gens.push(gens.indexOf(item));}}
		return valid_gens;
	}
	function random(){
		let random_gen = randItem(getCheckedGens());
		if(random_gen == 'empty'){return};
		current = randItem(gens[random_gen]['list']);
		gens[random_gen]['list'] = gens[random_gen]['list'].filter((item) => item !== current);
		poke_img.src = current["path"];
		refreshName();
		filterGens();
	}
	function refreshName(){
		if(current == undefined){return;}
		if(always_show.checked){showName();}
		else{hideName();}
	}
	function showName(){
		if(current == undefined){return;}
		poke_name.innerHTML = show_number.checked ? `#${current["number"]} ${current["name"]}` : current["name"];
		poke_region.innerHTML = current["region"];
	}
	function hideName(){
		if(current == undefined || always_show.checked){return;}
		poke_name.innerHTML = "???";
		poke_region.innerHTML = always_region.checked ? current["region"] : "";
	}
	function toggleCheckboxes(){
		let valid_checkboxes = [];
		for(const item of gens){if(!item['checkbox'].disabled){valid_checkboxes.push(item);}}
		if(getCheckedGens().length<valid_checkboxes.length){for(const item of valid_checkboxes){item['checkbox'].checked = true;}}
		else{for(const item of valid_checkboxes){item['checkbox'].checked = false;}}
	}
	function filterGens(){
		for(const item of gens){
			if(!item['list'].length){
				item['checkbox'].checked = false;
				item['checkbox'].disabled = true;
			}
		}
	}
	function toggleSilhouette(){
		if(current == undefined){return;}
		poke_img.style.filter = poke_img.style.filter == "brightness(0)" ? "brightness(1)" : "brightness(0)"
	}
	function spanToggle(index, checkbox){
		if(checkbox){gens[index]['checkbox'].checked = gens[index]['checkbox'].checked||gens[index]['checkbox'].disabled ? false : true;}
		else{
			const element = document.getElementById(`setting${index}`);
			element.checked = element.checked ? false : true;
			refreshName();
		}
	}
</script>
</body>
</html>
